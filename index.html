<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookids - Create Stories for Cognitive Development</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="logo">Bookids.</div>
            <div class="sidebar-section">DISCOVER</div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-step="step-10-library" data-tab="library-tab">
                    <object type="image/svg+xml" data="assets/icons/home.svg" class="menu-icon"></object>
                    <span>Home</span>
                </div>
                <div class="menu-item" data-step="step-1-landing">
                    <object type="image/svg+xml" data="assets/icons/search.svg" class="menu-icon"></object>
                    <span>Library</span>
                </div>
                <div class="menu-item" data-step="step-10-library" data-tab="dashboard-tab">
                    <object type="image/svg+xml" data="assets/icons/dashboard.svg" class="menu-icon"></object>
                    <span>Dashboard</span>
                </div>
            </div>
            <div class="profile-area">
                <div class="menu-item" data-step="step-7-login">
                    <object type="image/svg+xml" data="assets/icons/profile.svg" class="menu-icon"></object>
                    <span>Profile / Login</span>
                </div>
            </div>
        </div>
        <div class="main-content">
            
            <!-- Global Progress Bar -->
            <div id="global-progress-bar-container" class="global-progress-container">
                <div id="global-progress-bar" class="global-progress-bar"></div>
            </div>

            <!-- Step 1: Welcome/Landing Page -->
            <div id="step-1-landing" class="content-panel workflow-step active">
                <div class="landing-hero">
                    <h1>Let's help you generate your child's first story</h1>
                    <p class="subtitle">Answer a few simple questions to create a unique, personalized storybook.</p>
                    
                    <div class="welcome-features">
                        <div class="feature-card feature-card-1">
                            <h3>Personalized Characters</h3>
                            <p>Create avatars for your child and family members.</p>
                        </div>
                        <div class="feature-card feature-card-2">
                            <h3>Cognitive Boost</h3>
                            <p>Focus stories on areas like memory, focus, or problem-solving.</p>
                        </div>
                        <div class="feature-card feature-card-3">
                            <h3>Beautiful Illustrations</h3>
                            <p>Choose from various art styles to bring the story to life.</p>
                        </div>
                    </div>
                    
                    <button id="start-story-button" class="next-button pulsing-button">Start Your Story</button>
                </div>

                <div class="animated-background">
                    <div class="pulse-circle"></div>
                    <div class="pulse-circle delay-1"></div>
                    <div class="pulse-circle delay-2"></div>
                </div>
            </div>
            
            <!-- Step 2: Child Information Input -->
            <div id="step-2-child-info" class="content-panel workflow-step">
                <h1>Tell us about your child</h1>
                <p class="subtitle">This helps personalize the story and avatar.</p>
                
                <!-- Moved from #basic-info-form -->
                <div class="form-section">
                    <div class="form-group">
                        <label for="child-name">Child's Name</label>
                        <input type="text" id="child-name" placeholder="e.g., Alexander" class="text-input">
                    </div>
                    
                    <div class="form-group">
                        <label>Gender</label>
                        <div class="toggle-group">
                            <div class="toggle-option active">Boy</div>
                            <div class="toggle-option">Girl</div>
                        </div>
                    </div>
                    
                            <div class="form-group">
                        <label>Age</label>
                        <div class="slider-container">
                            <input type="range" min="3" max="10" value="5" class="slider" id="age-slider">
                            <div class="slider-value">5</div>
                            </div>
                            </div>
                    
                            <div class="form-group">
                        <label>Interests (Optional, Choose up to 3)</label>
                        <div class="interests-grid">
                            <div class="interest-option">Animals</div>
                            <div class="interest-option">Space</div>
                            <div class="interest-option">Dinosaurs</div>
                            <div class="interest-option">Ocean</div>
                            <div class="interest-option">Sports</div>
                            <div class="interest-option">Music</div>
                        </div>
                    </div>
                </div>
                <!-- End Moved Content -->

                <div class="button-container"> <!-- Button Container -->
                    <button class="back-button" onclick="navigateToStep('step-1-landing')">Back</button>
                    <button class="next-button" onclick="navigateToStep('step-3-avatar')">Next</button>
                </div>
            </div>
            
            <!-- Step 3: Avatar Creation -->
            <div id="step-3-avatar" class="content-panel workflow-step">
                <h1>Create an Avatar</h1>
                <p class="subtitle">Choose a look for the main character.</p>
                
                <div class="avatar-creation-container">
                    <!-- Upload/Select Toggle -->
                    <div class="form-group avatar-source-toggle">
                        <label>Avatar Source:</label>
                        <div class="toggle-group">
                            <div class="toggle-option active" data-source="select">Select Preset</div>
                            <div class="toggle-option" data-source="upload">Upload Image</div>
                        </div>
                    </div>

                    <!-- Selection Section (Initially Visible) -->
                    <div id="avatar-select-section">
                        <div class="form-section">
                            <label>Select Base Avatar</label>
                            <div class="avatar-selection-grid">
                                <!-- SVG Avatars that can change with gender/skin tone -->
                                <div class="avatar-option selected" data-avatar-index="0">
                                    <svg class="avatar-svg" width="100" height="100" viewBox="0 0 100 100">
                                        <circle class="avatar-face" cx="50" cy="50" r="40" fill="#e2b38f"/>
                                        <circle cx="35" cy="40" r="5" fill="#000"/>
                                        <circle cx="65" cy="40" r="5" fill="#000"/>
                                        <path class="avatar-smile" d="M 30 60 Q 50 80 70 60" fill="none" stroke="#000" stroke-width="3"/>
                                        <path class="avatar-hair boy-hair" d="M 20 30 Q 50 10 80 30 L 80 40 Q 50 20 20 40 Z" fill="#7A4A31"/>
                                        <path class="avatar-hair girl-hair" d="M 20 30 Q 50 10 80 30 L 80 60 Q 65 50 80 70 L 60 80 Q 50 70 40 80 L 20 70 Q 35 60 20 50 Z" fill="#7A4A31" style="display: none;"/>
                                    </svg>
                                </div>
                                <div class="avatar-option" data-avatar-index="1">
                                    <svg class="avatar-svg" width="100" height="100" viewBox="0 0 100 100">
                                        <circle class="avatar-face" cx="50" cy="50" r="40" fill="#e2b38f"/>
                                        <circle cx="35" cy="40" r="5" fill="#000"/>
                                        <circle cx="65" cy="40" r="5" fill="#000"/>
                                        <path class="avatar-smile" d="M 35 60 Q 50 70 65 60" fill="none" stroke="#000" stroke-width="3"/>
                                        <path class="avatar-hair boy-hair" d="M 25 25 L 35 15 L 65 15 L 75 25 L 75 35 L 25 35 Z" fill="#333"/>
                                        <path class="avatar-hair girl-hair" d="M 20 30 C 20 20 80 20 80 30 L 80 55 C 70 45 85 60 75 70 C 65 75 35 75 25 70 C 15 60 30 45 20 55 Z" fill="#333" style="display: none;"/>
                                    </svg>
                                </div>
                                <div class="avatar-option" data-avatar-index="2">
                                    <svg class="avatar-svg" width="100" height="100" viewBox="0 0 100 100">
                                        <circle class="avatar-face" cx="50" cy="50" r="40" fill="#e2b38f"/>
                                        <circle cx="35" cy="40" r="5" fill="#000"/>
                                        <circle cx="65" cy="40" r="5" fill="#000"/>
                                        <path class="avatar-smile" d="M 30 65 Q 50 75 70 65" fill="none" stroke="#000" stroke-width="3"/>
                                        <path class="avatar-hair boy-hair" d="M 30 20 Q 50 10 70 20 Q 80 30 70 40 Q 50 30 30 40 Q 20 30 30 20 Z" fill="#D4A76A"/>
                                        <path class="avatar-hair girl-hair" d="M 30 20 Q 50 10 70 20 Q 85 35 70 50 L 75 65 Q 60 55 50 65 Q 40 55 25 65 L 30 50 Q 15 35 30 20 Z" fill="#D4A76A" style="display: none;"/>
                                    </svg>
                                </div>
                                <div class="avatar-option" data-avatar-index="3">
                                    <svg class="avatar-svg" width="100" height="100" viewBox="0 0 100 100">
                                        <circle class="avatar-face" cx="50" cy="50" r="40" fill="#e2b38f"/>
                                        <circle cx="35" cy="40" r="5" fill="#000"/>
                                        <circle cx="65" cy="40" r="5" fill="#000"/>
                                        <path class="avatar-smile" d="M 30 60 Q 50 70 70 60" fill="none" stroke="#000" stroke-width="3"/>
                                        <rect class="avatar-hair boy-hair" x="25" y="10" width="50" height="25" rx="5" fill="#5C3817"/>
                                        <path class="avatar-hair girl-hair" d="M 20 20 Q 50 0 80 20 L 85 50 Q 70 40 75 70 Q 50 80 25 70 Q 30 40 15 50 Z" fill="#5C3817" style="display: none;"/>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <label>Select Skin Tone</label>
                            <div class="skin-tone-selector">
                                <!-- Placeholder: Skin tone swatches -->
                                <div class="skin-tone-swatch" data-color="#f3d3b8" style="background-color: #f3d3b8;"></div>
                                <div class="skin-tone-swatch selected" data-color="#e2b38f" style="background-color: #e2b38f;"></div>
                                <div class="skin-tone-swatch" data-color="#c78d6c" style="background-color: #c78d6c;"></div>
                                <div class="skin-tone-swatch" data-color="#a16849" style="background-color: #a16849;"></div>
                                <div class="skin-tone-swatch" data-color="#7a4a31" style="background-color: #7a4a31;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Upload Section (Initially Hidden) -->
                    <div id="avatar-upload-section" style="display: none;">
                        <div class="form-section">
                            <label for="avatar-upload-input">Upload Avatar Image</label>
                            <input type="file" id="avatar-upload-input" accept="image/png, image/jpeg, image/webp" class="file-input">
                            <div id="avatar-upload-preview" class="upload-preview-container">
                                <img id="avatar-preview-image" src="#" alt="Avatar Preview" style="display: none;">
                                <span id="avatar-preview-placeholder">No image selected</span>
                            </div>
                            <small>Upload a PNG, JPG, or WEBP file (Max 2MB).</small>
                        </div>
                    </div>

                    <!-- Customization (Common) -->
                    <div class="form-section">
                        <label for="avatar-customization">Customization Details (Optional)</label>
                        <input type="text" id="avatar-customization" placeholder="e.g., blue curly hair, freckles, glasses" class="text-input">
                        <small>Describe specific features you'd like the avatar to have.</small>
                    </div>
                </div>

                <div class="button-container"> <!-- Button Container -->
                    <button class="back-button" onclick="navigateToStep('step-2-child-info')">Back</button>
                    <button class="next-button" onclick="navigateToStep('step-4-cognitive')">Next</button>
                </div>
            </div>
            
            <!-- Step 4: Select Cognitive Focus -->
            <div id="step-4-cognitive" class="content-panel workflow-step">
                <h1>Cognitive areas to develop in your next book</h1>
                <p class="subtitle">We suggest you to pick up max. 2 for book</p>
                <div class="progress-indicator-container"> 
                    <!-- Placeholder for progress bar - styling in CSS -->
                    <div class="progress-bar"></div> 
                </div>
                
                <div class="cognitive-grid">
                    <div class="cognitive-card" data-area="executive-function">
                        <div class="card-content">
                            <h3>Executive Function</h3>
                            <p>Foundational "air traffic control" skills of the brain.</p>
                            <button class="learn-more" data-tooltip="Skills like planning, starting tasks, staying organized, and managing time.">Learn more</button>
                        </div>
                    </div>
                    
                    <div class="cognitive-card" data-area="attention-focus">
                        <div class="card-content">
                            <h3>Attention and Focus</h3>
                            <p>The ability to concentrate, sustain attention, and selectively attend stimuli.</p>
                            <button class="learn-more" data-tooltip="Helps filter distractions and maintain concentration on tasks or listening.">Learn more</button>
                        </div>
                    </div>
                    
                    <div class="cognitive-card" data-area="memory">
                        <div class="card-content">
                            <h3>Memory</h3>
                            <p>Involves encoding, storing, and retrieving information.</p>
                            <button class="learn-more" data-tooltip="Working memory for holding information and long-term memory for recall.">Learn more</button>
                        </div>
                     </div>
                    
                    <div class="cognitive-card" data-area="language">
                        <div class="card-content">
                            <h3>Language and communication</h3>
                            <p>Central to thought, learning and social development.</p>
                            <button class="learn-more" data-tooltip="Includes vocabulary, understanding grammar, expressing thoughts, and storytelling.">Learn more</button>
                        </div>
                    </div>
                    
                    <div class="cognitive-card" data-area="problem-solving">
                        <div class="card-content">
                            <h3>Reasoning and Problem Solving</h3>
                            <p>The ability to make sense of information and apply logic.</p>
                            <button class="learn-more" data-tooltip="Using logic, critical thinking, and creativity to overcome challenges.">Learn more</button>
                        </div>
                     </div>
                    
                    <div class="cognitive-card" data-area="conceptual">
                        <div class="card-content">
                            <h3>Conceptual Understanding</h3>
                            <p>Forming mental representations and categories.</p>
                            <button class="learn-more" data-tooltip="Grasping abstract ideas, understanding categories, and making connections.">Learn more</button>
                        </div>
                    </div>
                </div>

                <div class="button-container"> <!-- Button Container -->
                    <button class="back-button" onclick="navigateToStep('step-3-avatar')">Back</button>
                    <button class="next-button" onclick="navigateToStep('step-5-illustration')">Next</button>
                </div>
            </div>
            
            <!-- Step 5: Illustration Style Selection -->
            <div id="step-5-illustration" class="content-panel workflow-step">
                <h1>Choose an Illustration Style</h1>
                <p class="subtitle">Select the visual style for the book.</p>

                <!-- Moved from #art-styles -->
                <div class="art-style-grid">
                    <div class="art-style-card" data-style="watercolor">
                        <div class="art-preview">
                            <img src="assets/images/styles/watercolour.png" alt="Watercolor Illustration" class="style-image">
                        </div>
                        <p>Watercolor Illustration</p>
                    </div>
                    
                    <div class="art-style-card" data-style="digital">
                        <div class="art-preview">
                            <img src="assets/images/styles/digitalpainting.png" alt="Digital Painting" class="style-image">
                        </div>
                        <p>Digital Painting</p>
                            </div>
                            
                    <div class="art-style-card" data-style="pen-ink">
                        <div class="art-preview">
                            <img src="assets/images/styles/penandink.png" alt="Pen and Ink" class="style-image">
                                    </div>
                        <p>Pen and Ink</p>
                                </div>
                    
                    <div class="art-style-card" data-style="collage">
                        <div class="art-preview">
                            <img src="assets/images/styles/collage.png" alt="Collage Mixed Media" class="style-image">
                        </div>
                        <p>Mixed Media Collage</p>
                        </div>
                        
                    <div class="art-style-card" data-style="3d">
                        <div class="art-preview">
                            <img src="assets/images/styles/3d.png" alt="3D Rendering" class="style-image">
                        </div>
                        <p>3D Rendering</p>
                    </div>
                </div>
                <!-- End Moved Content -->

                <div class="button-container"> <!-- Button Container -->
                    <button class="back-button" onclick="navigateToStep('step-4-cognitive')">Back</button>
                    <button class="next-button" onclick="navigateToStep('step-6-customize')">Next</button>
                </div>
            </div>
            
            <!-- Step 6: Customize Story & Select Characters -->
            <div id="step-6-customize" class="content-panel workflow-step">
                <h1>A few more details to tailor it a bit more</h1>
                <p class="subtitle">Choose the characters for this story and add any specific requests.</p>

                <div class="customize-container-vertical"> 
                    <div class="customize-section">
                        <h3>Choose the avatars for this story</h3>
                        <div class="character-selection-grid" id="story-character-selection-grid">
                            <!-- Character cards for selection will be populated here by JS -->
                            <!-- Example Structure (to be generated by JS): -->
                            <!-- 
                            <div class="character-select-card active" data-char-id="avatar-1">
                                <div class="char-select-img-container">
                                    <img src="samplebooks/1.png" alt="Avatar Name" class="char-select-img">
                                </div>
                                <div class="char-select-info">
                                    <span class="char-select-name">Rick</span>
                                    <span class="char-select-desc">Main Avatar</span> 
                                </div>
                            </div>
                            <div class="character-select-card" data-char-id="char-jumbo">
                                <div class="char-select-img-container">
                                    <img src="samplebooks/2.png" alt="Jumbo" class="char-select-img">
                                </div>
                                <div class="char-select-info">
                                    <span class="char-select-name">Jumbo</span>
                                    <span class="char-select-desc">Bearded Collie</span> 
                                </div>
                            </div> 
                            -->
                            <div class="character-select-card add-new-char-card" id="add-new-story-character-btn">
                                <div class="add-new-char-icon">+</div>
                                <div class="char-select-info">
                                    <span class="char-select-name">Add a new one</span>
                                </div>
                            </div>
                        </div>
                        </div>
                        
                    <div class="customize-section">
                        <h3>Additional information you may want to include</h3>
                        <div class="form-group">
                            <textarea id="custom-prompt" placeholder="E.g., Amina loves everything related with the space and dragons." class="text-input custom-prompt" rows="4"></textarea>
                            <small>Include specific themes, settings, plot points, or things to avoid.</small>
                        </div>
                                    </div>
                                </div>
                                
                <div class="button-container"> 
                    <button class="back-button" onclick="navigateToStep('step-5-illustration')">Back</button>
                    <button class="next-button" onclick="navigateToStep('step-6b-confirmation')">Next</button> 
                                    </div>
                                </div>
                                
            <!-- Step 6b: Confirmation Summary -->
            <div id="step-6b-confirmation" class="content-panel workflow-step">
                <h1>Story Details Confirmation</h1>
                <p class="subtitle">Review your story details before we generate your book.</p>
                
                <div class="confirmation-container">
                    <div class="confirmation-section">
                        <h3>Child Information</h3>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Name:</span>
                            <span class="confirmation-value" id="confirm-name"></span>
                                    </div>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Age:</span>
                            <span class="confirmation-value" id="confirm-age"></span>
                                </div>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Gender:</span>
                            <span class="confirmation-value" id="confirm-gender"></span>
                        </div>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Interests:</span>
                            <span class="confirmation-value" id="confirm-interests"></span>
                                </div>
                            </div>
                    
                    <div class="confirmation-section">
                        <h3>Story Elements</h3>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Cognitive Focus:</span>
                            <span class="confirmation-value" id="confirm-cognitive"></span>
                        </div>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Illustration Style:</span>
                            <span class="confirmation-value" id="confirm-style"></span>
                        </div>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Story Length:</span>
                            <span class="confirmation-value" id="confirm-length"></span>
                </div>
                        <div class="confirmation-row">
                            <span class="confirmation-label">Story Type:</span>
                            <span class="confirmation-value" id="confirm-type"></span>
            </div>
        </div>
                    
                    <div class="confirmation-section">
                        <h3>Avatar & Characters</h3>
                        <!-- Add display for selected characters -->
                        <div class="confirmation-row">
                            <span class="confirmation-label">Characters in Story:</span>
                            <span class="confirmation-value" id="confirm-characters"></span>
                        </div>
                        <!-- Potentially add more avatar details like skin tone if needed -->
                        <!-- 
                        <div class="confirmation-row">
                            <span class="confirmation-label">Avatar Skin Tone:</span>
                            <span class="confirmation-value" id="confirm-avatar-skin"></span>
                        </div>
                        -->
                    </div>

                    <div class="confirmation-section">
                        <h3>Custom Requests</h3>
                        <!-- Add display for custom prompt -->
                        <div class="confirmation-row">
                            <span class="confirmation-label">Notes:</span>
                            <span class="confirmation-value" id="confirm-custom-prompt"></span>
                        </div>
                    </div>
                </div>
                
                <div class="prompt-preview">
                    <div class="prompt-header">
                        <h3>This will generate a story with the following structured prompt:</h3>
                        <button id="edit-prompt-button" class="link-button edit-prompt-btn">Edit</button>
                    </div>
                    <div class="prompt-box" id="structured-prompt">
                        <!-- Generated structured prompt will be displayed here -->
                        Generating prompt...
                    </div>
                    <textarea id="prompt-edit-textarea" class="text-input prompt-edit-area" style="display: none;"></textarea>
                    <button id="save-prompt-button" class="next-button save-prompt-btn" style="display: none;">Save Prompt</button>
                </div>

                <div class="button-container"> <!-- Button Container -->
                    <button class="back-button" onclick="navigateToStep('step-6-customize')">Back to Edit</button>
                    <button class="next-button" onclick="navigateToStep('step-7-login')">Proceed to Login</button>
                </div>
            </div>
            
            <!-- Step 7: Account Creation / Login -->
            <div id="step-7-login" class="content-panel workflow-step login-page-container">
                <!-- Centered Login Form -->
                <div class="login-form-minimal">
                    <h1>Create an account</h1>
                    <p class="subtitle">Enter your email to sign up for this app</p>
                    
                    <div class="form-group">
                        <input type="email" id="signup-email" placeholder="email@domain.com" class="text-input" aria-label="Email address">
                    </div>
                    
                    <button id="signup-email-button" class="login-btn primary full-width" onclick="navigateToStep('step-8-preview')">Sign up with email</button> 
                    
                    <div class="login-divider"><span>or continue with</span></div>
                    
                    <button id="google-signin-button" class="login-btn social-btn google-btn full-width" onclick="navigateToStep('step-8-preview')">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google logo" class="social-icon"> 
                        Google
                    </button>
                    
                    <p class="login-terms-minimal">By clicking continue, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a></p>
                    
                    <div class="login-switch">
                        Already have an account? <button id="switch-to-login-btn" class="link-button">Log in</button>
                    </div>
                    
                    <!-- Demo Account Button (Optional) -->
                    <button id="dev-pass-button-minimal" class="link-button dev-pass-link" onclick="navigateToStep('step-8-preview')">Continue with Demo Account</button>
                </div>
                <!-- End Centered Login Form -->
                
                 <!-- Button Container for Back -->
                 <div class="button-container login-back-button-container" style="position: absolute; bottom: 20px; left: 20px;"> 
                     <button class="back-button" onclick="navigateToStep('step-6b-confirmation')">Back</button>
                 </div>
            </div>
            
            <!-- Step 8: Preview the Book -->
            <div id="step-8-preview" class="content-panel workflow-step preview-page-container"> 
                <h1>Preview Your Book</h1>
                <p class="subtitle">Here's a sneak peek of your generated story.</p>
                
                <div id="book-preview-area">
                    <!-- Preview content will be injected here by JS -->
                    <div class="preview-placeholder">Generating preview...</div>
                </div>
                
                <div class="preview-controls">
                    <button id="regenerate-preview-button" class="preview-btn regenerate">Regenerate Preview</button>
                    <div class="preview-pagination">
                        <button id="preview-prev-button" class="preview-btn nav" disabled>&larr; Previous</button>
                        <span id="preview-page-indicator">Page X of Y</span>
                        <button id="preview-next-button" class="preview-btn nav" disabled>Next &rarr;</button>
            </div>
        </div>

                <div class="button-container preview-button-container">
                    <button class="back-button" onclick="navigateToStep('step-7-login')">Back</button> 
                    <button class="next-button save-library-button" onclick="navigateToStep('step-10-library')">Save to Library</button> 
                </div>
            </div>
            
            <!-- Step 10: Accessing the Library/Home -->
            <div id="step-10-library" class="content-panel workflow-step">
                <div class="library-header">
                    <div class="library-title">
                        <h1>Library of books</h1>
                        <p class="subtitle">The books your kid has read.</p>
                    </div>
                    <button class="add-book-btn">Add a book</button>
                </div>
                
                <!-- Tab Controls -->
                <div class="tab-controls">
                    <button class="tab-button active" data-tab="library-content">Library</button>
                    <button class="tab-button" data-tab="avatars-characters-content">Avatars & Characters</button>
                    <button class="tab-button" data-tab="dashboard-content">Dashboard</button>
                </div>
                
                <!-- Tab Content Areas -->
                <div class="tab-content active" id="library-content">
                    <div id="library-empty" style="display: none;">
                        <div class="empty-state-container">
                            <div class="empty-state-icon">ðŸ“š</div>
                            <h3>Your library is empty</h3>
                            <p>Create a story to get started with your first book!</p>
                            <button class="primary-button" onclick="navigateToStep('step-1-landing')">Create a Story</button>
                        </div>
                    </div>
                    
                    <div id="library-grid" class="modern-library-grid">
                        <!-- Book cards will be dynamically populated here -->
                        <div class="book-card">
                            <div class="book-card-cover">
                                <img src="samplebooks/1.png" alt="Book Cover">
                                <div class="book-overlay">
                                    <button class="read-book-btn">Read</button>
                                </div>
                            </div>
                            <div class="book-card-info">
                                <h3 class="book-title">Rick teaches a lesson</h3>
                                <p class="book-desc">An executive function book for Rick to improve focus.</p>
                            </div>
                            <div class="book-card-meta">
                                <span class="book-tag">Executive Function</span>
                                <span class="book-date">May 12, 2023</span>
                            </div>
                        </div>
                        
                        <div class="book-card">
                            <div class="book-card-cover">
                                <img src="samplebooks/2.png" alt="Book Cover">
                                <div class="book-overlay">
                                    <button class="read-book-btn">Read</button>
                                </div>
                            </div>
                            <div class="book-card-info">
                                <h3 class="book-title">Amina's Feelings Day</h3>
                                <p class="book-desc">An emotional regulation book for Amina to be more patient.</p>
                            </div>
                            <div class="book-card-meta">
                                <span class="book-tag">Emotional Regulation</span>
                                <span class="book-date">May 10, 2023</span>
                            </div>
                        </div>
                        
                        <div class="book-card">
                            <div class="book-card-cover loading-book">
                                <img src="samplebooks/3.png" alt="Book Cover">
                                <div class="book-overlay">
                                    <div class="book-loading">
                                        <div class="loading-spinner-small"></div>
                                        <span>Generating...</span>
                                    </div>
                                </div>
                            </div>
                            <div class="book-card-info">
                                <h3 class="book-title">Rick had a bad day</h3>
                                <p class="book-desc">An emotional regulation book for Rick to deal with emotions.</p>
                            </div>
                            <div class="book-card-meta">
                                <span class="book-tag">Emotional Regulation</span>
                                <span class="book-date">Just now</span>
                                </div>
                            </div>
                            
                        <div class="book-card">
                            <div class="book-card-cover">
                                <img src="samplebooks/4.png" alt="Book Cover">
                                <div class="book-overlay">
                                    <button class="read-book-btn">Read</button>
                                </div>
                            </div>
                            <div class="book-card-info">
                                <h3 class="book-title">Amina meets Alice</h3>
                                <p class="book-desc">A book to reflect on social skills for Amina.</p>
                            </div>
                            <div class="book-card-meta">
                                <span class="book-tag">Social Skills</span>
                                <span class="book-date">May 5, 2023</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="avatars-characters-content">
                    <div class="avatars-section">
                        <div class="avatars-header">
                            <h2>Avatars</h2>
                            <p class="subtitle">This will be the heroes of your stories</p>
                            <button class="add-avatar-btn">Add an avatar</button>
                        </div>
                        
                        <div class="avatars-grid">
                            <div class="avatar-card">
                                <div class="avatar-image">
                                    <img src="samplebooks/2.png" alt="Amina Avatar" class="avatar-img">
                                    </div>
                                <div class="avatar-info">
                                    <h3>Amina</h3>
                                    <p>4 years old</p>
                                </div>
                            </div>
                            
                            <div class="avatar-card">
                                <div class="avatar-image">
                                    <img src="samplebooks/1.png" alt="Rick Avatar" class="avatar-img">
                                </div>
                                <div class="avatar-info">
                                    <h3>Rick</h3>
                                    <p>6 years old</p>
                                </div>
                            </div>
                            
                            <div class="avatar-card">
                                <div class="avatar-image pet-avatar">
                                    <img src="samplebooks/2.png" alt="Jumbo" class="avatar-img">
                                </div>
                                <div class="avatar-info">
                                    <h3>Jumbo</h3>
                                    <p>Bearded Collie</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="dashboard-content">
                    <div class="dashboard-container">
                        <h2>Dashboard</h2>
                        <p class="subtitle">Track your child's cognitive development progress</p>
                        
                        <div class="dashboard-grid">
                            <div class="dashboard-card stats-card">
                                <h3>Your Stats</h3>
                                <div class="stats-grid">
                                    <div class="stat-item">
                                        <div class="stat-value" id="total-books">4</div>
                                        <div class="stat-label">Total Books</div>
                        </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="characters-created">3</div>
                                        <div class="stat-label">Characters</div>
                            </div>
                                    <div class="stat-item">
                                        <div class="stat-value" id="favorite-style">Watercolor</div>
                                        <div class="stat-label">Favorite Style</div>
                            </div>
                            </div>
                        </div>
                        
                            <div class="dashboard-card cognitive-progress-card">
                                <h3>Cognitive Development Focus</h3>
                                <div id="cognitive-progress" class="cognitive-progress">
                                    <div class="progress-item">
                                        <div class="progress-label">Executive Function</div>
                                        <div class="progress-bar-container">
                                            <div class="progress-bar-fill" style="width: 75%"></div>
                    </div>
                                        <div class="progress-value">75%</div>
                                </div>
                                    <div class="progress-item">
                                        <div class="progress-label">Emotional Regulation</div>
                                        <div class="progress-bar-container">
                                            <div class="progress-bar-fill" style="width: 60%"></div>
                                </div>
                                        <div class="progress-value">60%</div>
                                    </div>
                                    <div class="progress-item">
                                        <div class="progress-label">Social Skills</div>
                                        <div class="progress-bar-container">
                                            <div class="progress-bar-fill" style="width: 25%"></div>
                                        </div>
                                        <div class="progress-value">25%</div>
                                    </div>
                                </div>
                                </div>
                                
                            <div class="dashboard-card recommendations-card">
                                <h3>Recommendations</h3>
                                <div class="recommendations">
                                    <div class="recommendation-item">
                                        <div class="recommendation-icon">ðŸ’¡</div>
                                        <div class="recommendation-content">
                                            <h4>Problem Solving</h4>
                                            <p>Try creating a story focused on problem-solving skills next to help develop critical thinking.</p>
                                        </div>
                                    </div>
                                    <div class="recommendation-item">
                                        <div class="recommendation-icon">ðŸ”¤</div>
                                        <div class="recommendation-content">
                                            <h4>Language Development</h4>
                                            <p>Consider stories that introduce new vocabulary and language concepts.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            <!-- Loading Indicator -->
            <div id="loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Working...</p>
            </div>
            
            <!-- Error Modal -->
            <div id="error-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <span class="close-modal" onclick="document.getElementById('error-modal').style.display='none'">&times;</span>
                    </div>
                    <div id="error-content" class="modal-body">
                        <!-- Error message will be inserted here -->
                    </div>
                    <div class="modal-footer">
                        <button onclick="document.getElementById('error-modal').style.display='none'" class="modal-button">Close</button>
                    </div>
                </div>
            </div>

            <!-- Add Character Modal -->
            <div id="add-character-modal" class="modal">
                <div class="modal-content character-modal-content">
                    <span class="close-button" onclick="closeAddCharacterModal()">&times;</span>
                    <h2>Add New Character</h2>
                    
                    <div class="form-group">
                        <label for="new-char-name">Character Name</label>
                        <input type="text" id="new-char-name" placeholder="e.g., Luna the Cat" class="text-input">
                    </div>

                    <div class="form-group">
                        <label for="new-char-desc">Description / Relationship</label>
                        <input type="text" id="new-char-desc" placeholder="e.g., Wise old family pet" class="text-input">
                    </div>

                    <div class="form-group">
                        <label>Character Image (Optional)</label>
                        <div class="toggle-group avatar-source-toggle" id="new-char-source-toggle">
                            <div class="toggle-option active" data-source="none">No Image</div>
                            <div class="toggle-option" data-source="upload">Upload Image</div>
                        </div>
                    </div>

                    <div id="new-char-upload-section" class="form-group avatar-upload-section" style="display: none;">
                        <label for="new-char-upload-input">Upload Image (Max 2MB)</label>
                        <input type="file" id="new-char-upload-input" accept="image/png, image/jpeg, image/webp">
                        <div id="new-char-preview-container" class="avatar-preview-container">
                            <img id="new-char-preview-image" src="#" alt="Character Preview" style="display: none;">
                            <div id="new-char-preview-placeholder" class="avatar-preview-placeholder">+</div>
                        </div>
                        <small>Upload a picture of the character.</small>
                    </div>

                    <div class="modal-button-container">
                        <button class="cancel-button" onclick="closeAddCharacterModal()">Cancel</button>
                        <button id="save-new-character-btn" class="save-button">Save Character</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html> 